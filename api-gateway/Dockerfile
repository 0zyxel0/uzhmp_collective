# Use the official lightweight Node.js 12 image.
# https://hub.docker.com/_/node
FROM node:12-slim

# Create and change to the app directory.
WORKDIR /usr/src/app

# Assign ENV variables
# Bind the App to any IP
ENV NUXT_HOST=0.0.0.0
ENV NODE_ENV=prod
ENV NUXT_PORT=8899

# Axios Base URL
ENV APIBASE_URL="http://172.1.6.3:8081"

# Authentication Keys
ENV AUTH_PRIV_KEY="-----BEGIN RSA PRIVATE KEY-----\n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\n-----END RSA PRIVATE KEY-----"
ENV AUTH_PUB_KEY="-----BEGIN RSA PUBLIC KEY-----\nMIICCgKCAgEArkCTXPwBVKQX7/YXn9cC2fcS/eRTpGWa/iOtTbUthIglzoskK6YAVbMMDe/HbVeP5CnWrWoziNjcHRH3zVZ2IzMNhcEJFmEMl19WZD3wZeCL7u/NiF3xwpr7Wbi/RBOIGu/kXzor8+gzDZ9DVyLV6pqCAqrF8iTyfk5LlRu43G84JGm7x2ar6Fog0UKVcaMyZyfa+TCwFXeezeVYTqWXSrOrG7k5mKufYMMGxVLpP5nZcVHLYAyqhpS9I5np59sktIKBFGsbXZjO333aA+m6IAVH8/P0eatyr4pXf+Wl1rW0xMpoe4rpXxUIA/RQVwGECDN5JTZ57Eqca10J02UhyndFf2aV1w1bwpi6SuBO07hOrTyqOAoSJZgbqz3UU8X32nquttQfrpunFKyEd8gX+m6fp1wJnePImpMRitvwHFojuHZPEEuNIPQM1/RyoUiJSIOkP1ploy7IK8/yhlJe1zH/1BeO3TCzWTxMskc4qOCbKcL8gUFYWC3iYNYB+OJYKky83gFeaqitZ55sHqoL8qCmTKMf/GivHH4gM4GCK1gGmtY0DnfIB/uj8lQN4Zmh8RNer0ofnTv+1CKhIkpKcVSq06TMpbihRbk/e8+1XuUBBVwDfEloZw0q5Pu2tYzMSNpJOjiDmW0IuURgdamMsFARdcvS7sAcG7C+Xipu3+8CAwEAAQ==\n-----END RSA PUBLIC KEY-----"

# Token Expiry
ENV TIME_TO_EXPIRE="5h"

# Cloud DB Credentials
ENV ATLAS_USER_PROD="uzhmp-user"
ENV ATLAS_PASS_PROD="awtzGBTepiBIaX04"
ENV ATLAS_CLUSTER_PROD="uzh-mp.nad1m.mongodb.net"
ENV ATLAS_DB_PROD="UserDB"

# Service Endpoints
ENV MAP_SRV_API="http://172.1.6.5:8899"
ENV IMG_SRV_API="http://172.1.6.4:8899"

# Copy application dependency manifests to the container image.
# A wildcard is used to ensure both package.json AND package-lock.json are copied.
# Copying this separately prevents re-running npm install on every code change.
COPY package*.json ./

# Install production dependencies.
RUN npm install --only=production

# Copy local code to the container image.
COPY . ./

# Expose the Port Outside the container to the localhost
EXPOSE 8899

# Build the production Version of the Application
RUN npm run build

# Run the web service on container startup.
CMD [ "npm", "start" ]